<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>i-HELPÜ | NCST Weather Dashboard</title>
    <link rel="stylesheet" href="/css/Weather.css">
    <link rel="icon" type="image/x-icon" href="/Design asset/favicon_1758558051-trimmy-favicon.png">
    <link rel="icon" type="image/png" href="/logo scg 1.png">

</head>













<body>
    <div class="container">
        <div class="header">
            <h1>🌤️ NCST Weather Report </h1>
            <p>Real-time weather monitoring for our campus</p>
        </div>

        <div id="weather-content" class="loading">
            <div class="spinner"></div>
            <p>Loading weather data...</p>
        </div>
    </div>












    <script>
        const LAT = 14.328128486163267;
        const LON = 120.9412717880873;
        const OPEN_METEO_URL = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,rain,showers,weather_code,cloud_cover,pressure_msl,surface_pressure,wind_speed_10m,wind_direction_10m,wind_gusts_10m&hourly=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation_probability,precipitation,rain,showers,weather_code,pressure_msl,surface_pressure,cloud_cover,wind_speed_10m,wind_direction_10m,wind_gusts_10m&daily=weather_code,temperature_2m_max,temperature_2m_min,apparent_temperature_max,apparent_temperature_min,sunrise,sunset,uv_index_max,precipitation_sum,rain_sum,showers_sum,precipitation_probability_max,wind_speed_10m_max,wind_gusts_10m_max,wind_direction_10m_dominant&timezone=auto`;

        let weatherData = null;
        let forecastData = null;

        // Updated weather codes without snow/fog and clearer overcast
        const weatherCodes = {
            0: { desc: 'Clear sky', icon: '☀️', status: 'Clear Sky', class: 'sun-icon' },
            1: { desc: 'Mainly clear', icon: '🌤️', status: 'Mainly Clear', class: 'sun-icon' },
            2: { desc: 'Partly cloudy', icon: '⛅', status: 'Partly Cloudy', class: 'cloud-icon' },
            3: { desc: 'Heavy clouds', icon: '☁️', status: 'Heavily Cloudy', class: 'cloud-icon' },
            48: { desc: 'Very misty', icon: '🌫️', status: 'Very Misty', class: 'cloud-icon' },
            51: { desc: 'Light drizzle', icon: '🌦️', status: 'Light Drizzle', class: 'rain-icon' },
            53: { desc: 'Moderate drizzle', icon: '🌦️', status: 'Drizzle', class: 'rain-icon' },
            55: { desc: 'Dense drizzle', icon: '🌧️', status: 'Heavy Drizzle', class: 'rain-icon' },
            56: { desc: 'Light freezing drizzle', icon: '🌨️', status: 'Freezing Drizzle', class: 'rain-icon' },
            57: { desc: 'Dense freezing drizzle', icon: '🌨️', status: 'Heavy Freezing Drizzle', class: 'rain-icon' },
            61: { desc: 'Slight rain', icon: '🌧️', status: 'Light Rain', class: 'rain-icon' },
            63: { desc: 'Moderate rain', icon: '🌧️', status: 'Rain', class: 'rain-icon' },
            65: { desc: 'Heavy rain', icon: '🌧️', status: 'Heavy Rain', class: 'rain-icon' },
            66: { desc: 'Light freezing rain', icon: '🌨️', status: 'Freezing Rain', class: 'rain-icon' },
            67: { desc: 'Heavy freezing rain', icon: '🌨️', status: 'Heavy Freezing Rain', class: 'rain-icon' },
            71: { desc: 'Light rain', icon: '🌧️', status: 'Light Rain', class: 'rain-icon' },
            73: { desc: 'Moderate rain', icon: '🌧️', status: 'Rain', class: 'rain-icon' },
            75: { desc: 'Heavy rain', icon: '🌧️', status: 'Heavy Rain', class: 'rain-icon' },
            77: { desc: 'Rain showers', icon: '🌧️', status: 'Rain Showers', class: 'rain-icon' },
            80: { desc: 'Slight rain showers', icon: '🌦️', status: 'Rain Showers', class: 'rain-icon' },
            81: { desc: 'Moderate rain showers', icon: '🌦️', status: 'Rain Showers', class: 'rain-icon' },
            82: { desc: 'Violent rain showers', icon: '🌧️', status: 'Heavy Rain Showers', class: 'rain-icon' },
            85: { desc: 'Rain showers', icon: '🌨️', status: 'Rain Showers', class: 'rain-icon' },
            86: { desc: 'Heavy rain showers', icon: '🌨️', status: 'Heavy Rain Showers', class: 'rain-icon' },
            95: { desc: 'Thunderstorm', icon: '⛈️', status: 'Thunderstorm', class: 'storm-icon' },
            96: { desc: 'Thunderstorm with hail', icon: '⛈️', status: 'Thunderstorm with Hail', class: 'storm-icon' },
            99: { desc: 'Heavy thunderstorm', icon: '⛈️', status: 'Heavy Thunderstorm', class: 'storm-icon' }
        };

        async function fetchWeatherData() {
            try {
                console.log('Fetching weather data from Open-Meteo API...');
                
                const response = await fetch(OPEN_METEO_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Weather data received:', data);
                
                // Process current weather
                const currentWeatherCode = data.current.weather_code;
                const weatherInfo = weatherCodes[currentWeatherCode] || weatherCodes[0];
                
                weatherData = {
                    weather: [{
                        main: weatherInfo.status,
                        description: weatherInfo.desc,
                        status: weatherInfo.status,
                        iconClass: weatherInfo.class
                    }],
                    main: {
                        temp: data.current.temperature_2m,
                        feels_like: data.current.apparent_temperature,
                        humidity: data.current.relative_humidity_2m,
                        pressure: data.current.pressure_msl
                    },
                    wind: {
                        speed: data.current.wind_speed_10m / 3.6, // Convert km/h to m/s
                        deg: data.current.wind_direction_10m,
                        gust: data.current.wind_gusts_10m
                    },
                    visibility: 10000, // Default visibility in meters
                    dt: Date.now() / 1000,
                    name: 'NCST Campus',
                    icon: weatherInfo.icon,
                    precipitation: data.current.precipitation || 0,
                    rain: data.current.rain || 0
                };

                // Process forecast for today and tomorrow only
                const dailyData = data.daily;
                const forecast = [];
                const days = ['Today', 'Tomorrow'];
                
                for (let i = 0; i < Math.min(2, dailyData.time.length); i++) {
                    const weatherCode = dailyData.weather_code[i];
                    const weatherInfo = weatherCodes[weatherCode] || weatherCodes[0];
                    
                    forecast.push({
                        dt: new Date(dailyData.time[i]).getTime() / 1000,
                        main: {
                            temp_max: dailyData.temperature_2m_max[i],
                            temp_min: dailyData.temperature_2m_min[i]
                        },
                        weather: [{
                            description: weatherInfo.desc,
                            iconClass: weatherInfo.class
                        }],
                        day: days[i],
                        icon: weatherInfo.icon,
                        precipitation: dailyData.precipitation_sum[i] || 0,
                        uv_index: dailyData.uv_index_max[i] || 0
                    });
                }
                
                forecastData = { list: forecast };
                
                displayWeatherData();
                
            } catch (error) {
                console.error('Error fetching weather data:', error);
                document.getElementById('weather-content').innerHTML = `
                    <div style="text-align: center; color: white; padding: 40px;">
                        <h2>⚠️ Unable to load weather data</h2>
                        <p>Error: ${error.message}</p>
                        <p>Please check your connection and try again.</p>
                        <button onclick="fetchWeatherData()" style="margin-top: 20px; padding: 10px 20px; background: rgba(255,255,255,0.2); border: none; border-radius: 10px; color: white; cursor: pointer;">Retry</button>
                    </div>
                `;
            }
        }

        function getWindDirection(degrees) {
            const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
            return directions[Math.round(degrees / 22.5) % 16];
        }

        function calculateSuspensionRisk() {
            if (!weatherData) return { risk: 0, reasons: [] };

            let riskPercentage = 0;
            const reasons = [];
            const temp = weatherData.main.temp;
            const windSpeed = weatherData.wind.speed * 3.6; // Convert to km/h
            const description = weatherData.weather[0].description.toLowerCase();
            const precipitation = weatherData.precipitation;

            // Extreme heat risk
            if (temp >= 40) {
                riskPercentage += 40;
                reasons.push('Extreme heat warning');
            } else if (temp >= 35) {
                riskPercentage += 25;
                reasons.push('Very high temperature');
            }

            // Wind risk
            if (windSpeed >= 60) {
                riskPercentage += 35;
                reasons.push('Dangerous wind speeds');
            } else if (windSpeed >= 40) {
                riskPercentage += 20;
                reasons.push('Strong winds');
            }

            // Storm/Thunderstorm risk
            if (description.includes('thunderstorm') || description.includes('storm')) {
                if (description.includes('heavy') || description.includes('violent')) {
                    riskPercentage += 50;
                    reasons.push('Severe thunderstorm');
                } else {
                    riskPercentage += 30;
                    reasons.push('Thunderstorm activity');
                }
            }

            // Heavy rain risk
            if (precipitation >= 20) {
                riskPercentage += 30;
                reasons.push('Heavy rainfall');
            } else if (precipitation >= 10) {
                riskPercentage += 15;
                reasons.push('Moderate to heavy rain');
            }

            return { risk: Math.min(riskPercentage, 95), reasons };
        }

        function getRecommendations() {
            if (!weatherData) return [];

            const temp = weatherData.main.temp;
            const windSpeed = weatherData.wind.speed * 3.6;
            const description = weatherData.weather[0].description.toLowerCase();
            const precipitation = weatherData.precipitation;
            const recommendations = [];

            // Temperature recommendations
            if (temp >= 35) {
                recommendations.push({ icon: '💧', text: 'Bring plenty of water and stay hydrated' });
                recommendations.push({ icon: '🧢', text: 'Wear hat and light-colored clothing' });
                recommendations.push({ icon: '🌳', text: 'Stay in shaded areas when possible' });
            } else if (temp <= 20) {
                recommendations.push({ icon: '🧥', text: 'Bring a jacket or sweater' });
            }

            // Rain recommendations
            if (precipitation >= 1 || description.includes('rain') || description.includes('drizzle')) {
                recommendations.push({ icon: '☂️', text: 'Bring umbrella or raincoat' });
                recommendations.push({ icon: '👟', text: 'Wear waterproof shoes if meron ka ' });
                if (precipitation >= 10) {
                    recommendations.push({ icon: '🏠', text: 'Consider staying indoors if possible' });
                }
            }

            // Wind recommendations
            if (windSpeed >= 30) {
                recommendations.push({ icon: '🎒', text: 'Secure loose items and bags' });
                recommendations.push({ icon: '⚠️', text: 'Be cautious near trees and buildings' });
            }

            // Storm recommendations
            if (description.includes('thunderstorm') || description.includes('storm')) {
                recommendations.push({ icon: '🏠', text: 'Stay indoors during storms' });
                recommendations.push({ icon: '📱', text: 'Keep phone charged for emergencies' });
                recommendations.push({ icon: '⚡', text: 'Avoid open areas and metal objects' });
            }

            // Default safe weather recommendations
            if (recommendations.length === 0) {
                recommendations.push({ icon: '😎', text: 'Great weather for outdoor activities!' });
                recommendations.push({ icon: '🌤️', text: 'Perfect day to enjoy campus life' });
                recommendations.push({ icon: '💼', text: 'Normal school supplies needed' });
            }

            return recommendations;
        }

        function isDangerous() {
            if (!weatherData) return false;

            const temp = weatherData.main.temp;
            const windSpeed = weatherData.wind.speed * 3.6;
            const description = weatherData.weather[0].description.toLowerCase();
            const precipitation = weatherData.precipitation;

            return (
                temp >= 35 || 
                windSpeed >= 40 || 
                description.includes('thunderstorm') || 
                description.includes('storm') || 
                precipitation >= 10
            );
        }

        function displayWeatherData() {
            if (!weatherData || !forecastData) return;

            const currentTemp = Math.round(weatherData.main.temp);
            const status = weatherData.weather[0].status || weatherData.weather[0].main;
            const description = weatherData.weather[0].description;
            const icon = weatherData.icon;
            const iconClass = weatherData.weather[0].iconClass || 'bounce';

            const suspensionData = calculateSuspensionRisk();
            const recommendations = getRecommendations();
            const dangerous = isDangerous();

            const weatherHTML = `
                <div class="current-weather weather-card main-weather-box">
                    <h2 style="font-size: 1.8rem; margin-bottom: 15px; font-weight: bold;">Current Weather in NCST</h2>
                    <div class="weather-icon animated-icon ${iconClass}">${icon}</div>
                    <div class="current-temp">${currentTemp}°C</div>
                    <h3 style="font-size: 1.8rem; margin-bottom: 10px; font-weight: bold; text-transform: uppercase; letter-spacing: 2px;">${status}</h3>
                    <p style="font-size: 1.2rem; opacity: 0.9; margin-bottom: 20px;">Feels like ${Math.round(weatherData.main.feels_like)}°C</p>
                    
                    <div class="weather-details">
                        <div class="detail-item">
                            <div class="detail-icon">💨</div>
                            <div>
                                <div style="font-weight: bold;">Wind Speed</div>
                                <div>${Math.round(weatherData.wind.speed * 3.6)} km/h ${getWindDirection(weatherData.wind.deg)}</div>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">💧</div>
                            <div>
                                <div style="font-weight: bold;">Humidity</div>
                                <div>${weatherData.main.humidity}%</div>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">🌡️</div>
                            <div>
                                <div style="font-weight: bold;">Pressure</div>
                                <div>${Math.round(weatherData.main.pressure)} hPa</div>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">🌧️</div>
                            <div>
                                <div style="font-weight: bold;">Precipitation</div>
                                <div>${weatherData.precipitation.toFixed(1)} mm</div>
                            </div>
                        </div>
                    </div>
                </div>

                ${dangerous ? `
                <div class="danger-box">
                    <div class="danger-header">
                        <span>⚠️</span>
                        <span>WEATHER DANGER ALERT</span>
                    </div>
                    <p style="font-size: 1.1rem; margin-bottom: 15px;">Potentially hazardous weather conditions detected. Please take necessary precautions.</p>
                    <div class="suspension-percentage">
                        <div>Class Suspension Risk</div>
                        <div style="font-size: 2rem; color: #ffff00;">${suspensionData.risk}%</div>
                        <div style="font-size: 0.9rem; margin-top: 5px;">Based on: ${suspensionData.reasons.join(', ')}</div>
                    </div>
                </div>
                ` : `
                <div class="safe-box">
                    <div class="danger-header">
                        <span>✅</span>
                        <span>WEATHER CONDITIONS SAFE</span>
                    </div>
                    <p style="font-size: 1.1rem; margin-bottom: 15px;">Current weather conditions are safe for normal campus activities.</p>
                    <div class="suspension-percentage">
                        <div>Class Suspension Risk</div>
                        <div style="font-size: 2rem; color: #ffffff;">${suspensionData.risk}%</div>
                        <div style="font-size: 0.9rem; margin-top: 5px;">Low risk - Normal operations expected</div>
                    </div>
                </div>
                `}

                <div class="recommendations-box">
                    <div class="danger-header">
                        <span>💡</span>
                        <span>RECOMMENDATIONS</span>
                    </div>
                    <p style="margin-bottom: 15px;">What to bring or do based on current conditions:</p>
                    ${recommendations.map(rec => `
                        <div class="recommendation-item">
                            <span style="font-size: 1.2rem;">${rec.icon}</span>
                            <span>${rec.text}</span>
                        </div>
                    `).join('')}
                </div>

                <div class="forecast-container">
                    <h3 class="forecast-title">Today & Tomorrow Forecast</h3>
                    <div class="forecast-grid">
                        ${forecastData.list.map(day => `
                            <div class="forecast-item">
                                <div class="forecast-day" style="font-size: 1.4rem; font-weight: bold;">${day.day}</div>
                                <div class="forecast-icon animated-icon ${day.weather[0].iconClass}">${day.icon}</div>
                                <div style="text-transform: capitalize; font-size: 1rem; margin: 10px 0; font-weight: bold; letter-spacing: 0.5px;">${day.weather[0].description}</div>
                                <div class="forecast-temp">
                                    <div style="font-size: 1.6rem; font-weight: bold;">${Math.round(day.main.temp_max)}°C</div>
                                    <div style="opacity: 0.8; font-size: 1.2rem;">${Math.round(day.main.temp_min)}°C</div>
                                </div>
                                <div style="font-size: 1rem; margin-top: 10px; opacity: 0.9;">
                                    💧 ${day.precipitation.toFixed(1)}mm
                                </div>
                                <div style="font-size: 1rem; margin-top: 5px; opacity: 0.9;">
                                    ☀️ UV Index: ${day.uv_index.toFixed(1)}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            document.getElementById('weather-content').innerHTML = weatherHTML;
        }

        //! Initialize the weather dashboard
        fetchWeatherData();

        // Refresh weather data every 10 minutes
        setInterval(fetchWeatherData, 600000);
    </script>
</body>
</html>